var myScroll;var dev_height;var dev_width;var whole_width;var margin_p;var margin_l;xmlDocument=new XMLHttpRequest();var page_xml_path=base_url+"document.xml";xmlDocument.open("GET",page_xml_path,false);xmlDocument.send();xmlDocument=xmlDocument.responseXML;var device_compt_width_portrait=0;var device_compt_height_portrait=0;var device_compt_width_landscape=0;var device_compt_height_landscape=0;function set_device_info(orientationmode)
{var allitems=xmlDocument.getElementsByTagName("normal");var page_width=allitems[1].attributes.getNamedItem("width").value;var page_height=allitems[1].attributes.getNamedItem("height").value;if($(window).height()>$(window).width())
{var scr_p_width=parseInt($(window).width());var scr_p_height=parseInt($(window).height())-50;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))){scr_p_height=parseInt($(window).height());}
var scr_l_width=parseInt($(document).height());var scr_l_height=$(window).width()-($(document).height()-$(window).height())-85;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))){scr_l_height=$(document).width()-85;}
device_compt_width_portrait=page_width*scr_p_height/page_height;device_compt_height_portrait=scr_p_height;if(device_compt_width_portrait>scr_p_width)
{device_compt_height_portrait=scr_p_width*device_compt_height_portrait/device_compt_width_portrait;device_compt_width_portrait=scr_p_width;}
device_compt_width_landscape=page_width*scr_l_height/page_height;device_compt_height_landscape=scr_l_height;margin_p=($(window).width()-device_compt_width_portrait)/2;margin_l=(parseInt($(document).height())-device_compt_width_landscape*2)/2;}
else
{var scr_l_width=parseInt($(window).width());var scr_l_height=parseInt($(window).height())-50;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))){scr_l_height=parseInt($(window).height());}
var scr_p_width=parseInt($(document).height());var scr_p_height=$(window).width()-($(document).height()-$(window).height())-85;if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))){scr_p_height=$(window).width()-85;}
device_compt_width_landscape=page_width*scr_l_height/page_height;device_compt_height_landscape=scr_l_height;if(device_compt_width_portrait>scr_l_width)
{device_compt_height_landscape=scr_l_width*device_compt_height_landscape/device_compt_width_landscape;device_compt_width_landscape=scr_l_width;}
device_compt_width_portrait=page_width*scr_p_height/page_height;device_compt_height_portrait=scr_p_height;if(device_compt_width_portrait>scr_p_width)
{device_compt_height_portrait=scr_p_width*device_compt_height_portrait/device_compt_width_portrait;device_compt_width_portrait=scr_p_width;}
margin_p=(parseInt($(document).height())-device_compt_width_portrait)/2;margin_l=(parseInt($(window).width())-device_compt_width_landscape*2)/2;}}
function get_element_info(property,orientation,current_page,page_number,e_location)
{var X;var Y;var T;var X1,Y1;var onIMGlocation=e_location.replace(/ /gi,",");X=onIMGlocation.substr(0,onIMGlocation.indexOf(","));T=onIMGlocation.substr(X.length+1,(onIMGlocation.length)-(X.length));Y=T.substr(0,T.indexOf(","));T=T.substr(Y.length+1,(T.length)-(Y.length));X=parseInt(X);Y=parseInt(Y);var w=T.substr(0,T.indexOf(","));var h=parseInt(T.substr(w.length+1,(T.length)-(w.length)));w=parseInt(w);var allitems=xmlDocument.getElementsByTagName("normal");var page_width=allitems[1].attributes.getNamedItem("width").value;var page_height=allitems[1].attributes.getNamedItem("height").value;var portrait_width_scale=Math.round(device_compt_width_portrait/page_width*100)/100;var landscape_width_scale=Math.round(device_compt_width_landscape/page_width*100)/100;var portrait_height_scale=Math.round(device_compt_height_portrait/page_height*100)/100;var landscape_height_scale=Math.round(device_compt_height_landscape/page_height*100)/100;var x1_p=X*portrait_width_scale;x1_p=x1_p+(parseInt(current_page)+parseInt(page_number)-1)*device_compt_width_portrait;var y1_p=Y*portrait_height_scale;var w_p=w*portrait_width_scale;var h_p=h*portrait_height_scale;var x1_l=X*landscape_width_scale;x1_l=x1_l+(parseInt(current_page)+parseInt(page_number))*device_compt_width_landscape;var y1_l=Y*landscape_height_scale;var w_l=w*landscape_width_scale;var h_l=h*landscape_height_scale;if(orientation=="landscape")
{if(property=="width")
return w_l;else if(property=="height")
return h_l;else if(property=="top")
return y1_l;else
return x1_l;}
else
{if(property=="width")
return w_p;else if(property=="height")
return h_p;else if(property=="top")
return y1_p;else
return x1_p;}}
function load_page(p_number,mode)
{var curr=0;var page_number=parseInt(p_number);if(mode=="post")
{if($(window).height()>$(window).width())
{curr=myScroll.currPageX;}
else
{if(!id)
curr=parseInt(myScroll.currPageX*2)+parseInt(myScroll.currPageX-1)*3;else
{curr=parseInt(myScroll.currPageX*2);}}}
var cached_pageZero=document.getElementById('ZPages_'+(parseInt(curr)+p_number));if(cached_pageZero&&!cached_pageZero.src)
{cached_pageZero.src=base_url+"XPage_"+(parseInt(curr)+page_number)+".jpg";xmlDoc=new XMLHttpRequest();var page_xml_path=base_url+"Page_"+(parseInt(curr)+page_number)+".xml";xmlDoc.open("GET",page_xml_path,false);xmlDoc.send();xmlDoc=xmlDoc.responseXML;if(!xmlDoc)
return false;var allitems=xmlDoc.getElementsByTagName("link");var Linklocation="";var Linkurl="";var Linktype="";for(var i=0;i<allitems.length;i++){Linklocation=allitems[i].attributes.getNamedItem("loc").value;if(allitems[i].attributes.getNamedItem("url")==null)
continue;Linkurl=allitems[i].attributes.getNamedItem("url").value;link_type=allitems[i].attributes.getNamedItem("linktype").value;var landscape_div=document.createElement('div');landscape_div.style.width=get_element_info("width","landscape",curr,page_number,Linklocation)+'px';landscape_div.style.height=get_element_info("height","landscape",curr,page_number,Linklocation)+'px';landscape_div.style.top=get_element_info("top","landscape",curr,page_number,Linklocation)+'px';landscape_div.style.left=get_element_info("left","landscape",curr,page_number,Linklocation)+'px';landscape_div.style.position="absolute";landscape_div.style.backgroundColor="#cccccc";landscape_div.style.opacity=0.2;var landscape_external_link=document.createElement('a');landscape_external_link.style.display='block';landscape_external_link.style.height='100%';landscape_external_link.setAttribute('class',"landscape_link");if(link_type=="0")
{landscape_external_link.setAttribute('target',"_new");if(Linkurl.indexOf("http")==-1)
landscape_external_link.setAttribute('href',"http://"+Linkurl);else
landscape_external_link.setAttribute('href',Linkurl);}
else if(link_type=="1")
{landscape_external_link.setAttribute('href',"mailto:"+Linkurl);}
else
{landscape_external_link.setAttribute('target',"_self");landscape_external_link.setAttribute('href',mobile_url+"index.html?"+"id="+Linkurl);}
landscape_external_link.appendChild(landscape_div);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(landscape_external_link);var portrait_div=document.createElement('div');portrait_div.style.width=get_element_info("width","portrait",curr,page_number,Linklocation)+'px';portrait_div.style.height=get_element_info("height","portrait",curr,page_number,Linklocation)+'px';portrait_div.style.top=get_element_info("top","portrait",curr,page_number,Linklocation)+'px';portrait_div.style.left=get_element_info("left","portrait",curr,page_number,Linklocation)+'px';portrait_div.style.position="absolute";portrait_div.style.backgroundColor="#cccccc";portrait_div.style.opacity=0.2;var portrait_external_link=document.createElement('a');portrait_external_link.style.display='block';portrait_external_link.style.height='100%';portrait_external_link.setAttribute('class',"portrait_link");if(link_type=="0")
{portrait_external_link.setAttribute('target',"_new");if(Linkurl.indexOf("http")==-1)
portrait_external_link.setAttribute('href',"http://"+Linkurl);else
portrait_external_link.setAttribute('href',Linkurl);}
else if(link_type=="1")
{portrait_external_link.setAttribute('href',"mailto:"+Linkurl);}
else
{var doc_id=querySt('doc');portrait_external_link.setAttribute('target',"_self");portrait_external_link.setAttribute('href',mobile_url+"index.html?"+"id="+Linkurl);}
portrait_external_link.appendChild(portrait_div);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(portrait_external_link);}
var allitems=xmlDoc.getElementsByTagName("video");var video_location="";var video_url="";var video_type="self";var autoPlay="";var loop="";var show_control="";for(var i=0;i<allitems.length;i++){video_location=allitems[i].attributes.getNamedItem("loc").value;video_url=allitems[i].attributes.getNamedItem("url").value;autoPlay=allitems[i].attributes.getNamedItem("autoplay").value;loop=allitems[i].attributes.getNamedItem("playloop").value;show_control=allitems[i].attributes.getNamedItem("showcontrols").value;var landscape_div=document.createElement('div');landscape_div.style.width=get_element_info("width","landscape",curr,page_number,video_location)+'px';landscape_div.style.height=get_element_info("height","landscape",curr,page_number,video_location)+'px';landscape_div.style.top=get_element_info("top","landscape",curr,page_number,video_location)+'px';landscape_div.style.left=get_element_info("left","landscape",curr,page_number,video_location)+'px';landscape_div.style.position="absolute";landscape_div.style.backgroundColor="transparent";landscape_div.style.opacity=1;landscape_div.setAttribute('class',"landscape_link");var portrait_div=document.createElement('div');portrait_div.style.width=get_element_info("width","portrait",curr,page_number,video_location)+'px';portrait_div.style.height=get_element_info("height","portrait",curr,page_number,video_location)+'px';portrait_div.style.top=get_element_info("top","portrait",curr,page_number,video_location)+'px';portrait_div.style.left=get_element_info("left","portrait",curr,page_number,video_location)+'px';portrait_div.style.position="absolute";portrait_div.style.backgroundColor="transparent";portrait_div.style.opacity=1;portrait_div.setAttribute('class',"portrait_link");if(video_url.indexOf("youtu.be/")==7)
{youtube_url="http://www.youtube.com/embed"+video_url.substr(15);var landscape_iframe=document.createElement('iframe');landscape_iframe.style.width=get_element_info("width","landscape",curr,page_number,video_location)+'px';landscape_iframe.style.height=get_element_info("height","landscape",curr,page_number,video_location)+'px';landscape_iframe.src=youtube_url;landscape_iframe.frameborder='0';landscape_iframe.allowfullscreen="allowfullscreen";landscape_div.appendChild(landscape_iframe);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(landscape_div);var portrait_iframe=document.createElement('iframe');portrait_iframe.style.width=get_element_info("width","portrait",curr,page_number,video_location)+'px';portrait_iframe.style.height=get_element_info("height","portrait",curr,page_number,video_location)+'px';portrait_iframe.src=youtube_url;portrait_iframe.frameborder='0';portrait_iframe.allowfullscreen='allowfullscreen';portrait_div.appendChild(portrait_iframe);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(portrait_div);}
else
{var landscape_video=document.createElement('video');landscape_video.setAttribute('width',get_element_info("width","landscape",curr,page_number,video_location)+'px');landscape_video.setAttribute('height',get_element_info("height","landscape",curr,page_number,video_location)+'px');landscape_video.setAttribute('controls','controls');landscape_video.setAttribute('autoplay','');landscape_video.setAttribute('loop','loop');var landscape_source=document.createElement('source');landscape_source.setAttribute('src',base_url+"res/"+video_url);landscape_source.setAttribute('type','video/mp4');landscape_video.appendChild(landscape_source);landscape_div.appendChild(landscape_video);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(landscape_div);var portrait_video=document.createElement('video');portrait_video.setAttribute('width',get_element_info("width","portrait",curr,page_number,video_location)+'px');portrait_video.setAttribute('height',get_element_info("height","portrait",curr,page_number,video_location)+'px');portrait_video.setAttribute('controls','controls');portrait_video.setAttribute('autoplay','');portrait_video.setAttribute('loop','loop');var portrait_source=document.createElement('source');portrait_source.setAttribute('src',base_url+"res/"+video_url);portrait_source.setAttribute('type','video/mp4');portrait_video.appendChild(portrait_source);portrait_div.appendChild(portrait_video);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(portrait_div);}}
var allitems=xmlDoc.getElementsByTagName("audio");var audio_location="";var audio_url="";var autoPlay="";var loop="";var show_control="";for(var i=0;i<allitems.length;i++){audio_location=allitems[i].attributes.getNamedItem("loc").value;audio_url=allitems[i].attributes.getNamedItem("name").value;autoPlay=allitems[i].attributes.getNamedItem("autoplay").value;loop=allitems[i].attributes.getNamedItem("playloop").value;show_control=allitems[i].attributes.getNamedItem("showcontrols").value;var landscape_div=document.createElement('div');landscape_div.style.width=get_element_info("width","landscape",curr,page_number,audio_location)+'px';landscape_div.style.height=get_element_info("height","landscape",curr,page_number,audio_location)+'px';landscape_div.style.top=get_element_info("top","landscape",curr,page_number,audio_location)+'px';landscape_div.style.left=get_element_info("left","landscape",curr,page_number,audio_location)+'px';landscape_div.style.position="absolute";landscape_div.style.backgroundColor="transparent";landscape_div.style.opacity=1;landscape_div.setAttribute('class',"landscape_link");var portrait_div=document.createElement('div');portrait_div.style.width=get_element_info("width","portrait",curr,page_number,audio_location)+'px';portrait_div.style.height=get_element_info("height","portrait",curr,page_number,audio_location)+'px';portrait_div.style.top=get_element_info("top","portrait",curr,page_number,audio_location)+'px';portrait_div.style.left=get_element_info("left","portrait",curr,page_number,audio_location)+'px';portrait_div.style.position="absolute";portrait_div.style.backgroundColor="transparent";portrait_div.style.opacity=1;portrait_div.setAttribute('class',"portrait_link");var landscape_audio=document.createElement('audio');landscape_audio.setAttribute('width',get_element_info("width","landscape",curr,page_number,audio_location)+'px');landscape_audio.setAttribute('height',get_element_info("height","landscape",curr,page_number,audio_location)+'px');landscape_audio.setAttribute('controls','controls');landscape_audio.setAttribute('autoplay','');landscape_audio.setAttribute('loop','loop');var landscape_source=document.createElement('source');landscape_source.setAttribute('src',base_url+"res/"+audio_url);landscape_source.setAttribute('type','audio/mpeg');landscape_audio.appendChild(landscape_source);landscape_div.appendChild(landscape_audio);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(landscape_div);var portrait_audio=document.createElement('audio');portrait_audio.setAttribute('width',get_element_info("width","portrait",curr,page_number,audio_location)+'px');portrait_audio.setAttribute('height',get_element_info("height","portrait",curr,page_number,audio_location)+'px');portrait_audio.setAttribute('controls','controls');portrait_audio.setAttribute('autoplay','');portrait_audio.setAttribute('loop','loop');var portrait_source=document.createElement('source');portrait_source.setAttribute('src',base_url+"res/"+audio_url);portrait_source.setAttribute('type','audio/mpeg');portrait_audio.appendChild(portrait_source);portrait_div.appendChild(portrait_audio);document.getElementById('ZPage_'+(parseInt(curr)+page_number)).appendChild(portrait_div);}
if($(window).height()>$(window).width())
{$(".landscape_link").css('visibility','hidden');$(".landscape_link").css('display','none');$(".portrait_link").css('visibility','visible');$(".portrait_link").css('display','block');}
else
{$(".landscape_link").css('visibility','visible');$(".landscape_link").css('display','block');$(".portrait_link").css('visibility','hidden');$(".portrait_link").css('display','none');}}}
function querySt(ji)
{hu=window.location.search.substring(1);gy=hu.split("&");for(i=0;i<gy.length;i++){ft=gy[i].split("=");if(ft[0]==ji){return ft[1];}}}
var id=querySt('id');var pageNum;function loaded(){myScroll=new iScroll('wrapper',{snap:true,momentum:false,hScrollbar:false,vScrollbar:false,zoom:true,onZoom:function(){$('#page_label').html('');},onZoomStart:function(){$('#page_label').html('');},onZoomEnd:function(){$('#page_label').html('');},onScrollEnd:function(){if($(window).height()>$(window).width())
{load_page(-4,"post");load_page(-5,"post");load_page(-6,"post");load_page(7,"post");load_page(8,"post");load_page(9,"post");if(myScroll.scale==1)
{pageNum=parseInt(myScroll.currPageX)+1;$('#page_label').html('Page '+pageNum);}}
else
{load_page(-4,"post");load_page(-5,"post");load_page(-6,"post");load_page(-7,"post");load_page(-8,"post");load_page(7,"post");load_page(8,"post");load_page(9,"post");load_page(10,"post");load_page(11,"post");if(myScroll.scale==1)
{pageNum=parseInt(myScroll.currPageX)*2;$('#page_label').html('Page '+pageNum);}}}});if(id&&$(window).height()>$(window).width())
{load_page(parseInt(id),"ini");load_page(parseInt(id)-3,"ini");load_page(parseInt(id)-2,"ini");load_page(parseInt(id)-1,"ini");load_page(parseInt(id)+1,"ini");load_page(parseInt(id)+2,"ini");load_page(parseInt(id)+3,"ini");load_page(parseInt(id)+4,"ini");load_page(parseInt(id)+5,"ini");load_page(parseInt(id)+6,"ini");myScroll.scrollToPage(id-1,0);}
else
{var p_id=Math.floor((parseInt(id)+1)/2);load_page(parseInt(p_id)*2,"ini");load_page(parseInt(p_id)*2-3,"ini");load_page(parseInt(p_id)*2-2,"ini");load_page(parseInt(p_id)*2-1,"ini");load_page(parseInt(p_id)*2+1,"ini");load_page(parseInt(p_id)*2+2,"ini");load_page(parseInt(p_id)*2+3,"ini");load_page(parseInt(p_id)*2+4,"ini");load_page(parseInt(p_id)*2+5,"ini");load_page(parseInt(p_id)*2+6,"ini");myScroll.scrollToPage(p_id,0);}}
$(document).ready(function(){$('body').jpreLoader();check_settings();set_device_info("portrait");set_device_info("landscape");load_page(1,"ini");load_page(2,"ini");load_page(3,"ini");load_page(4,"ini");load_page(5,"ini");load_page(6,"ini");load_page(7,"ini");load_page(8,"ini");if($(window).height()>$(window).width())
{dev_height=device_compt_height_portrait;dev_width=device_compt_width_portrait;whole_width=dev_width*number_of_pages;$('li').css('width',dev_width);$('li').css('height',dev_height);$('#wrapper').css('width',dev_width);$('#wrapper').css('height',dev_height);$('#wrapper').css('margin-left',margin_p);$('#scroller').css('width',whole_width);$('#page_label').css('margin-top',dev_height-18);$(".landscape_link").css('visibility','hidden');$(".landscape_link").css('display','none');$(".portrait_link").css('visibility','visible');$(".portrait_link").css('display','block');var child=document.getElementById('intro');var parent=document.getElementById('thelist');}
else
{dev_height=device_compt_height_landscape;dev_width=device_compt_width_landscape;whole_width=dev_width*(parseInt(number_of_pages)+1);$('li').css('width',dev_width);$('li').css('height',dev_height);$('#wrapper').css('width',dev_width*2);$('#wrapper').css('height',dev_height);$('#wrapper').css('margin-left',margin_l);$('#scroller').css('width',whole_width);$('#page_label').css('margin-top',dev_height-18);$(".landscape_link").css('visibility','visible');$(".landscape_link").css('display','block');$(".portrait_link").css('visibility','hidden');$(".portrait_link").css('display','none');}});$(window).bind('orientationchange',function(e){if($(window).height()>$(window).width())
{dev_height=device_compt_height_portrait;dev_width=device_compt_width_portrait;whole_width=dev_width*number_of_pages;$('li').css('width',dev_width);$('li').css('height',dev_height);$('#wrapper').css('width',dev_width);$('#wrapper').css('height',dev_height);$('#wrapper').css('margin-left',margin_p);$('#scroller').css('width',whole_width);$('#page_label').css('margin-top',dev_height-18);$('#page_label').html('');$(".landscape_link").css('visibility','hidden');$(".landscape_link").css('display','none');$(".portrait_link").css('visibility','visible');$(".portrait_link").css('display','block');myScroll.refresh();myScroll.scrollToPage(parseInt(myScroll.currPageX)*2,0,200);var child=document.getElementById('intro');var parent=document.getElementById('thelist');parent.removeChild(child);myScroll.refresh();}
else
{dev_height=device_compt_height_landscape;dev_width=device_compt_width_landscape;whole_width=dev_width*(parseInt(number_of_pages)+1);$('li').css('width',dev_width);$('li').css('height',dev_height);$('#wrapper').css('width',dev_width*2);$('#wrapper').css('height',dev_height);$('#wrapper').css('margin-left',margin_l);$('#scroller').css('width',whole_width);$('#page_label').css('margin-top',dev_height-18);$('#page_label').html('');$(".landscape_link").css('visibility','visible');$(".landscape_link").css('display','block');$(".portrait_link").css('visibility','hidden');$(".portrait_link").css('display','none');myScroll.refresh();var child=document.createElement('li');child.setAttribute('id','intro');var parent=document.getElementById('thelist');var cover=document.getElementById('cover');parent.insertBefore(child,parent.firstChild);parent=document.getElementById('thelist');myScroll.refresh();myScroll.scrollToPage(Math.floor((parseInt(myScroll.currPageX)+1)/2),0,200);}});document.addEventListener('DOMContentLoaded',loaded,false);